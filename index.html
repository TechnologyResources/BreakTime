<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BreakTime Buddy - Ù…Ø¤Ù‚Øª Ø§Ù„Ø¨Ø±ÙŠÙƒØ§Øª</title>
      <link rel="icon" href="images/favicon.png" type="image/png" />

    <script>
        // Ø¯Ø§Ù„Ø© ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡Ø§ Ù‚Ø¨Ù„ ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙØ¶ÙŠÙ„ Ø§Ù„Ù…Ø­ÙÙˆØ¸
        function applyDarkModePreference() {
            const isDarkMode = localStorage.getItem('theme') === 'dark' || 
                                (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);
            if (isDarkMode) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }
        applyDarkModePreference();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap');
        body {
            font-family: 'Tajawal', sans-serif;
        }
        /* Custom styles for the break selection buttons */
        .time-slot {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        .time-slot:hover:not(.booked):not([disabled]) {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }
        /* Dark Mode adjustments for custom hover effect */
        .dark .time-slot:hover:not(.booked):not([disabled]) {
            box-shadow: 0 8px 15px rgba(255, 255, 255, 0.05);
        }

        .floating-notification {
            animation: floatUp 4s ease forwards;
        }
        @keyframes floatUp {
            0% { opacity: 0; transform: translateY(20px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }
        .timer-text {
            font-size: 0.75rem; /* text-xs */
            font-weight: 700; /* font-bold */
        }
         /* Style for the Admin Modal */
        .modal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen dark:from-gray-900 dark:to-black dark:text-gray-100">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-12 relative">
            
            <button id="themeToggle" class="absolute top-0 left-0 p-3 rounded-full bg-indigo-100 text-indigo-600 hover:bg-indigo-200 dark:bg-gray-700 dark:text-yellow-400 dark:hover:bg-gray-600 transition-colors" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹">
                <i data-feather="moon" class="w-6 h-6"></i>
            </button>
            
            <button id="adminToggle" class="absolute top-0 right-0 p-3 rounded-full bg-indigo-100 text-indigo-600 hover:bg-indigo-200 dark:bg-gray-700 dark:text-indigo-400 dark:hover:bg-gray-600 transition-colors" title="Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… (Ø¥Ø¯Ø§Ø±Ø©)">
                <i data-feather="settings" class="w-6 h-6"></i>
            </button>
            <h1 class="text-5xl font-extrabold text-indigo-800 mb-2 tracking-wide dark:text-indigo-400">BreakTime Buddy â³</h1>
            <p class="text-lg text-gray-600 dark:text-gray-400">Ù†Ø¸Ø§Ù… Ø­Ø¬Ø² ÙˆÙ…ØªØ§Ø¨Ø¹Ø© ÙØªØ±Ø§Øª Ø§Ù„Ø±Ø§Ø­Ø© (Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ: 15 Ø¯ØŒ 30 Ø¯ØŒ 15 Ø¯)</p>
        </header>

        <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-2xl overflow-hidden dark:bg-gray-800 dark:shadow-none dark:border dark:border-indigo-900">
            
            <div id="shiftSelection" class="p-6 border-b border-gray-200 dark:border-gray-700">
                <h2 class="text-3xl font-extrabold text-indigo-900 mb-6 text-center dark:text-white">
                    Ø§Ø®ØªØ± ÙˆØ±Ø¯ÙŠØ© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <button id="morningShift" onclick="selectShift('morning')" 
                            class="shift-card bg-white dark:bg-gray-700 dark:border-gray-600 border-2 border-transparent p-6 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:scale-[1.02] cursor-pointer focus:outline-none focus:ring-4 focus:ring-blue-300 dark:hover:shadow-indigo-900/50">
                        <div class="flex flex-col items-center">
                            <i data-feather="sun" class="w-12 h-12 text-yellow-500 mb-3 drop-shadow-md"></i>
                            <span class="text-xl font-extrabold text-gray-800 mb-1 dark:text-gray-100">Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„ØµØ¨Ø§Ø­ÙŠ</span>
                            <span class="text-sm text-gray-500 font-medium dark:text-gray-300">9:00 ØµØ¨Ø§Ø­Ù‹Ø§ - 5:00 Ù…Ø³Ø§Ø¡Ù‹</span>
                            <span class="mt-4 inline-block bg-blue-50 text-blue-700 text-xs font-bold px-3 py-1 rounded-full dark:bg-blue-900 dark:text-blue-300">
                                Ø§Ù„Ø¨Ø±ÙŠÙƒ Ù…ØªØ§Ø­ Ø¨ÙŠÙ† 10:00 Øµ Ùˆ 4:00 Ù…
                            </span>
                        </div>
                    </button>

                    <button id="eveningShift" onclick="selectShift('evening')" 
                            class="shift-card bg-white dark:bg-gray-700 dark:border-gray-600 border-2 border-transparent p-6 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:scale-[1.02] cursor-pointer focus:outline-none focus:ring-4 focus:ring-purple-300 dark:hover:shadow-indigo-900/50">
                        <div class="flex flex-col items-center">
                            <i data-feather="moon" class="w-12 h-12 text-purple-600 mb-3 drop-shadow-md"></i>
                            <span class="text-xl font-extrabold text-gray-800 mb-1 dark:text-gray-100">Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠ</span>
                            <span class="text-sm text-gray-500 font-medium dark:text-gray-300">3:00 Ù…Ø³Ø§Ø¡Ù‹ - 11:00 Ù…Ø³Ø§Ø¡Ù‹</span>
                            <span class="mt-4 inline-block bg-purple-50 text-purple-700 text-xs font-bold px-3 py-1 rounded-full dark:bg-purple-900 dark:text-purple-300">
                                Ø§Ù„Ø¨Ø±ÙŠÙƒ Ù…ØªØ§Ø­ Ø¨ÙŠÙ† 4:00 Ù… Ùˆ 10:00 Ù…
                            </span>
                        </div>
                    </button>
                </div>
            </div>

            <div id="breakSelection" class="hidden p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-100">Ø§Ø®ØªØ± ÙØªØ±Ø§Øª Ø§Ù„Ø±Ø§Ø­Ø© (Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ):</h2>
                    <div class="flex items-center gap-2 bg-indigo-100 text-indigo-800 font-bold px-4 py-1.5 rounded-full text-lg dark:bg-indigo-900 dark:text-indigo-300">
                        <span id="selectedCount">0</span>
                        <span>/ 3</span>
                    </div>
                </div>
                
                <p class="text-sm text-center text-gray-600 mb-4 font-bold dark:text-gray-400">
                    ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¨Ø±ÙŠÙƒØ§Øª Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨: <span class="text-indigo-700 dark:text-indigo-300">15 Ø¯Ù‚ÙŠÙ‚Ø©</span> ØŒ Ø«Ù… <span class="text-red-700 dark:text-red-300">30 Ø¯Ù‚ÙŠÙ‚Ø©</span> ØŒ Ø«Ù… <span class="text-indigo-700 dark:text-indigo-300">15 Ø¯Ù‚ÙŠÙ‚Ø©</span>.
                </p>
                
                <div id="timeSlotsContainer" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3 mb-6 p-3 bg-gray-50 rounded-lg border border-gray-200 dark:bg-gray-900 dark:border-gray-700">
                    </div>
                
                <div class="flex flex-col sm:flex-row gap-3">
                    <input id="employeeName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù" 
                           class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
                    
                    <button id="confirmButton" disabled class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-lg shadow-md transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-indigo-700 dark:hover:bg-indigo-600">
                        ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²
                    </button>
                    <button onclick="resetSelection()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-6 rounded-lg shadow-md transition-all duration-300 dark:bg-gray-600 dark:hover:bg-gray-500 dark:text-white">
                        Ø§Ø®ØªÙŠØ§Ø± ÙˆØ±Ø¯ÙŠØ© Ø£Ø®Ø±Ù‰
                    </button>
                </div>
            </div>

            <div id="scheduleDisplay" class="p-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4 dark:text-gray-100">Ø¬Ø¯ÙˆÙ„ ÙØªØ±Ø§Øª Ø§Ù„Ø±Ø§Ø­Ø© Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©</h2>
                <div id="scheduleTable" class="bg-gray-50 rounded-xl shadow-inner overflow-hidden border border-gray-200 dark:bg-gray-900 dark:border-indigo-900">
                    <div class="grid grid-cols-12 bg-gray-200 font-bold text-gray-700 text-sm md:text-base dark:bg-gray-700 dark:text-gray-200">
                        <div class="col-span-3 p-3 border-r border-gray-300 text-center dark:border-gray-600">Ø§Ù„Ù…ÙˆØ¸Ù</div>
                        <div class="col-span-3 p-3 border-r border-gray-300 text-center dark:border-gray-600">Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø§Ù„Ø£ÙˆÙ„ (15 Ø¯)</div>
                        <div class="col-span-3 p-3 border-r border-gray-300 text-center dark:border-gray-600">Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø§Ù„Ø«Ø§Ù†ÙŠ (30 Ø¯)</div>
                        <div class="col-span-3 p-3 text-center">Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø§Ù„Ø«Ø§Ù„Ø« (15 Ø¯)</div>
                    </div>
                    <div id="scheduleContent" class="divide-y divide-gray-200 dark:divide-gray-700">
                        <div class="grid grid-cols-12 text-center items-center py-4 px-2 text-gray-500 dark:text-gray-400">
                            <div class="col-span-12 p-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ±Ø¯ÙŠØ© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-6 text-center text-gray-600 dark:text-gray-400">
            <p id="currentTime" class="text-md font-medium bg-white/50 inline-block px-4 py-2 rounded-lg shadow-inner dark:bg-gray-800/50"></p>
        </div>

        <div id="notificationContainer" class="fixed bottom-4 right-4 space-y-2 z-50"></div>
    </div>

    <div id="adminModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0">
        <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-lg dark:bg-gray-800 dark:border dark:border-indigo-900">
            <div class="flex justify-between items-center border-b pb-3 mb-4 dark:border-gray-700">
                <h3 class="text-2xl font-bold text-indigo-700 dark:text-indigo-400">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… (Admin)</h3>
                <button onclick="document.getElementById('adminModal').classList.add('hidden', 'opacity-0')" class="text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400">
                    <i data-feather="x" class="w-6 h-6"></i>
                </button>
            </div>

            <div id="adminStep1">
                <p class="mb-4 text-gray-600 dark:text-gray-300">Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ:</p>
                <input id="adminCode" type="password" placeholder="Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ"
                       class="w-full border border-gray-300 rounded-lg px-4 py-2 mb-4 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                <button id="adminLoginButton" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 rounded-lg transition-colors dark:bg-indigo-700 dark:hover:bg-indigo-600">
                    Ø¯Ø®ÙˆÙ„
                </button>
            </div>

            <div id="adminStep2" class="hidden">
                <p class="text-lg font-semibold mb-3 text-indigo-700 dark:text-indigo-400 border-b pb-2 dark:border-gray-700">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ÙŠØ¯ÙˆÙŠØ§Ù‹:</p>
                
                <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg dark:bg-red-900/20 dark:border-red-900">
                    <h4 class="text-lg font-bold text-red-800 dark:text-red-400 mb-2">Ø­Ø°Ù Ù…ÙˆØ¸Ù ÙƒØ§Ù…Ù„ ÙˆØ³Ø¬Ù„ Ø¨Ø±ÙŠÙƒØ§ØªÙ‡ âš ï¸</h4>
                    <p class="text-sm text-red-700 dark:text-red-300 mb-3">Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨Ø±ÙŠÙƒØ§Øª Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ø§Ù„Ø§Ø³Ù… ÙˆØ¬Ø¹Ù„Ù‡Ø§ Ù…ØªØ§Ø­Ø© Ù„Ù„Ø­Ø¬Ø² Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>
                    <input id="deleteEmployeeName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø±Ø§Ø¯ Ø­Ø°ÙÙ‡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„"
                           class="w-full border border-gray-300 rounded-lg px-4 py-2 mb-4 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    <button id="deleteEmployeeButton" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 rounded-lg shadow-md transition-colors dark:bg-red-700 dark:hover:bg-red-600">
                        <i data-feather="user-x" class="w-5 h-5 inline-block ml-2"></i>
                        Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù ÙˆØ­Ø¬ÙˆØ²Ø§ØªÙ‡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
                    </button>
                </div>
                <div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg dark:bg-yellow-900/20 dark:border-yellow-900">
                    <h4 class="text-lg font-bold text-yellow-800 dark:text-yellow-400 mb-2">Ø­Ø°Ù Ø¨Ø±ÙŠÙƒ Ù„Ù…ÙˆØ¸Ù Ù…Ø­Ø¯Ø¯ (Admin Override)</h4>
                    <p class="text-sm text-yellow-700 dark:text-yellow-300 mb-3">ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø¨Ø±ÙŠÙƒ ÙˆØ§Ø­Ø¯ Ù…Ù† Ø³Ø¬Ù„ Ù…ÙˆØ¸Ù Ù…Ø¹ÙŠÙ† Ø¨Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ø¨Ø±ÙŠÙƒ (1ØŒ 2ØŒ Ø£Ùˆ 3).</p>
                    <input id="deleteBreakName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù"
                           class="w-full border border-gray-300 rounded-lg px-4 py-2 mb-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    <input id="deleteBreakIndex" type="number" min="1" max="3" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¨Ø±ÙŠÙƒ (1 Ø£Ùˆ 2 Ø£Ùˆ 3)"
                           class="w-full border border-gray-300 rounded-lg px-4 py-2 mb-4 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    <button id="deleteSingleBreakButton" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 rounded-lg shadow-md transition-colors dark:bg-yellow-700 dark:hover:bg-yellow-600">
                        <i data-feather="minus-circle" class="w-5 h-5 inline-block ml-2"></i>
                        Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠÙƒ
                    </button>
                </div>
                
                <p class="text-lg font-semibold mb-2 text-gray-700 dark:text-gray-200 border-b pb-2 dark:border-gray-700">Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„:</p>
                <div class="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg dark:bg-red-900/20 dark:border-red-900">
                    <p class="text-sm font-medium text-red-700 dark:text-red-400 mb-2">Ø­Ø¬Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ:</p>
                    <span id="storageSizeDisplay" class="text-xl font-bold text-red-800 dark:text-red-300">0 KB</span>
                </div>

                <button id="deleteStorageButton" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 rounded-lg shadow-md transition-colors dark:bg-red-700 dark:hover:bg-red-600">
                    <i data-feather="trash-2" class="w-5 h-5 inline-block ml-2"></i>
                    Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
                </button>
                <p class="text-xs text-red-500 mt-2 text-center dark:text-red-400">âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.</p>
            </div>

        </div>
    </div>
    <script>
        // Ø¯Ø§Ù„Ø© ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡Ø§ Ù‚Ø¨Ù„ ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙØ¶ÙŠÙ„ Ø§Ù„Ù…Ø­ÙÙˆØ¸
        // (ØªÙ… Ù†Ù‚Ù„Ù‡Ø§ Ù„Ù„Ø£Ø¹Ù„Ù‰ Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ Ù‚Ø¨Ù„ Ø¸Ù‡ÙˆØ± Ø§Ù„Ù…Ø­ØªÙˆÙ‰)
        
        
        feather.replace();
        
        // ****** Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ 1: ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ******
        let employees = JSON.parse(localStorage.getItem('breakTimeBuddyEmployees')) || [];
        let selectedShift = null;
        let selectedBreaks = []; // Ø³ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙƒØ§Ø¦Ù†Ø§Øª { time: "10:00 Øµ", duration: 15 }
        
        const BREAK_TYPES = {
            '15': 15, // Ù…Ø¯Ø© 15 Ø¯Ù‚ÙŠÙ‚Ø©
            '30': 30  // Ù…Ø¯Ø© 30 Ø¯Ù‚ÙŠÙ‚Ø©
        };
        const MAX_TOTAL_BREAKS = 3;
        
        // ******* Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„ÙØ±Ø¶ Ø§Ù„ØªØ±ØªÙŠØ¨ *******
        const REQUIRED_ORDER = [15, 30, 15]; // Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ: 15 Ø¯ØŒ 30 Ø¯ØŒ 15 Ø¯
        
        
        // ØªÙˆÙ„ÙŠØ¯ ÙØªØ±Ø§Øª Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø§Ù„Ù…ØªØ§Ø­Ø©
        const generateBreakTimes = (startHour, endHour) => {
            const slots = [];
            for (let h = startHour; h < endHour; h++) {
                for (let m = 0; m < 60; m += 15) {
                    let time = `${String(h % 12 || 12).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
                    let period = h >= 12 && h < 24 ? 'Ù…' : 'Øµ';
                    
                    // Ø¨Ø±ÙŠÙƒ 15 Ø¯Ù‚ÙŠÙ‚Ø©
                    if (h + (m + 15) / 60 <= endHour) {
                        slots.push({ time: `${time} ${period}`, duration: 15 });
                    }
                    
                    // Ø¨Ø±ÙŠÙƒ 30 Ø¯Ù‚ÙŠÙ‚Ø© (ÙÙ‚Ø· ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© ÙˆÙ†ØµÙ Ø§Ù„Ø³Ø§Ø¹Ø©)
                    if (m % 30 === 0 && h + (m + 30) / 60 <= endHour) {
                        slots.push({ time: `${time} ${period}`, duration: 30 });
                    }
                }
            }
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª
            const uniqueSlots = Array.from(new Set(slots.map(s => `${s.time}-${s.duration}`)))
                                             .map(str => {
                                                 const [time, durationStr] = str.split('-');
                                                 return { time: time, duration: Number(durationStr) };
                                             });
            
            // Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø·Ø§Ù‚
            const filterSlots = (slots, startHour, endHour) => {
                const today = new Date();
                return slots.filter(slot => {
                    const [timeStr, period] = slot.time.split(' ');
                    let [hours, minutes] = timeStr.split(':').map(Number);
                    if (period === 'Ù…' && hours !== 12) hours += 12;
                    if (period === 'Øµ' && hours === 12) hours = 0;
                    
                    // ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ù„Ù„Ø¨Ø±ÙŠÙƒ
                    const startTime = new Date(today.getFullYear(), today.getMonth(), today.getDate(), hours, minutes, 0, 0);
                    const endTime = new Date(startTime.getTime() + slot.duration * 60000);
                    
                    // ØªØ­ÙˆÙŠÙ„ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø¥Ù„Ù‰ ØªÙ†Ø³ÙŠÙ‚ 24 Ø³Ø§Ø¹Ø© Ù„ØºØ±Ø¶ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
                    const endLimit = new Date(today.getFullYear(), today.getMonth(), today.getDate(), endHour, 0, 0, 0);
                    
                    return endTime <= endLimit;
                });
            };
            
            return filterSlots(uniqueSlots, startHour, endHour).sort((a, b) => timeToDate(a.time) - timeToDate(b.time));
        };

        const morningBreakStartTimes = generateBreakTimes(10, 16); // 10:00 Øµ Ø¥Ù„Ù‰ 4:00 Ù… (16:00)
        const eveningBreakStartTimes = generateBreakTimes(16, 22); // 4:00 Ù… (16:00) Ø¥Ù„Ù‰ 10:00 Ù… (22:00)

        const shiftSelection = document.getElementById('shiftSelection');
        const breakSelection = document.getElementById('breakSelection');
        const timeSlotsContainer = document.getElementById('timeSlotsContainer');
        const selectedCount = document.getElementById('selectedCount');
        const employeeName = document.getElementById('employeeName');
        const confirmButton = document.getElementById('confirmButton');
        const scheduleContent = document.getElementById('scheduleContent');
        const currentTimeDisplay = document.getElementById('currentTime');
        const notificationContainer = document.getElementById('notificationContainer');
        const themeToggle = document.getElementById('themeToggle');
        
        // ****** Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ******
        const ADMIN_CODE = '!#?!#!@@??#!'; // Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©
        const adminToggle = document.getElementById('adminToggle');
        const adminModal = document.getElementById('adminModal');
        const adminCode = document.getElementById('adminCode');
        const adminLoginButton = document.getElementById('adminLoginButton');
        const adminStep1 = document.getElementById('adminStep1');
        const adminStep2 = document.getElementById('adminStep2');
        const deleteStorageButton = document.getElementById('deleteStorageButton');
        const storageSizeDisplay = document.getElementById('storageSizeDisplay');
        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ù„Ø®Ø§ØµÙŠØ© Ø­Ø°Ù Ø¨Ø±ÙŠÙƒ Ù…ÙˆØ¸Ù Ù…Ø­Ø¯Ø¯ (Ù…ÙˆØ¬ÙˆØ¯Ø© Ø³Ø§Ø¨Ù‚Ø§Ù‹)
        const deleteBreakName = document.getElementById('deleteBreakName');
        const deleteBreakIndex = document.getElementById('deleteBreakIndex');
        const deleteSingleBreakButton = document.getElementById('deleteSingleBreakButton');
        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø®Ø§ØµÙŠØ© Ø­Ø°Ù Ù…ÙˆØ¸Ù ÙƒØ§Ù…Ù„
        const deleteEmployeeName = document.getElementById('deleteEmployeeName');
        const deleteEmployeeButton = document.getElementById('deleteEmployeeButton');
        // *******************************************************


        // UTILITY FUNCTIONS

        function timeToDate(timeString) {
            const [time, period] = timeString.split(' ');
            let [hours, minutes] = time.split(':').map(Number);

            if (period === 'Ù…' && hours !== 12) {
                hours += 12;
            } else if (period === 'Øµ' && hours === 12) {
                hours = 0;
            }

            const today = new Date();
            let date = new Date(today.getFullYear(), today.getMonth(), today.getDate(), hours, minutes, 0, 0);
            
            return date;
        }

        function formatTimeDifference(ms) {
            const totalSeconds = Math.max(0, Math.floor(ms / 1000));
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            const pad = (num) => num.toString().padStart(2, '0');
            
            if (hours > 0) return `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
            return `${pad(minutes)}:${pad(seconds)}`;
        }
        
        function getBreakEndString(startTime, duration) {
            const startDate = timeToDate(startTime);
            const endDate = new Date(startDate.getTime() + duration * 60000);
            
            const options = { hour: '2-digit', minute: '2-digit', hour12: true };
            let endString = endDate.toLocaleTimeString('ar-EG', options);
            
            // ØªØµØ­ÙŠØ­ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ (Ù‚Ø¯ ØªØ®ØªÙ„Ù Ø§Ù„Ø¨ÙŠØ¦Ø©)
            endString = endString.replace('Øµ', 'Øµ').replace('Ù…', 'Ù…'); 
            
            return endString;
        }

        function toggleTheme() {
            const htmlElement = document.documentElement;
            const isDark = htmlElement.classList.toggle('dark');
            const icon = themeToggle.querySelector('i');

            if (isDark) {
                localStorage.setItem('theme', 'dark');
                icon.setAttribute('data-feather', 'sun');
            } else {
                localStorage.setItem('theme', 'light');
                icon.setAttribute('data-feather', 'moon');
            }
            feather.replace();

            if (selectedShift) {
                renderTimeSlots();
                renderSchedule();
            }
        }
        
        function updateThemeIcon() {
            const htmlElement = document.documentElement;
            const icon = themeToggle.querySelector('i');
            if (htmlElement.classList.contains('dark')) {
                icon.setAttribute('data-feather', 'sun');
            } else {
                icon.setAttribute('data-feather', 'moon');
            }
            feather.replace();
        }

        function showNotification(message, type) {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };
            const icon = {
                success: 'check-circle',
                error: 'x-circle',
                info: 'info'
            };

            const notification = document.createElement('div');
            notification.className = `floating-notification flex items-center p-4 rounded-lg shadow-xl text-white ${colors[type]} transform translate-y-20 opacity-0`;
            notification.innerHTML = `
                <i data-feather="${icon[type]}" class="w-6 h-6 ml-2"></i>
                <span class="font-medium">${message}</span>
            `;
            
            notificationContainer.appendChild(notification);
            feather.replace();

            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ø¯Ø© Ø§Ù„Ø£Ù†Ù…ÙŠØ´Ù†
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // ****** Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ 2: Ø¯Ø§Ù„Ø© Ù„Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ******
        function saveEmployees() {
            localStorage.setItem('breakTimeBuddyEmployees', JSON.stringify(employees));
        }
        
        // ---------------------------------------------------------------------
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ØªØ®Ø²ÙŠÙ† (Ø§Ù„Ù…Ø¶Ø§ÙØ© Ù„Ø·Ù„Ø¨Ùƒ)
        // ---------------------------------------------------------------------
function clearEmployeeStorage() {
    // ØªÙØ±ÙŠØº Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
    employees.length = 0;
    saveEmployees(); // Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§Ø±ØºØ©
    
    // ÙŠØ¬Ø¨ ØªØ¹Ø±ÙŠÙ Ø¯Ø§Ù„Ø© Ù„Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Modal)
    // closeAdminModal(); 
    renderSchedule(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
    showNotification('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­.', 'success');
}

      function deleteEmployeeAndBreaks() {
    // ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù‡Ø°Ù‡ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ù…ÙØ¹Ø±ÙØ© ÙƒØ¹Ù†Ø§ØµØ± DOM ÙÙŠ ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    const name = adminEmployeeSelect.value;
    const shift = adminShiftSelect.value;

    if (!name || !shift) {
        showNotification('ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³Ù… Ù…ÙˆØ¸Ù ÙˆÙˆØ±Ø¯ÙŠØ© Ù„Ø­Ø°ÙÙ‡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.', 'error');
        return;
    }
    const initialLength = employees.length;
    // ØªØµÙÙŠØ© Ø§Ù„Ù…ØµÙÙˆÙØ© Ù„Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ù…Ø§ Ø¹Ø¯Ø§ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ø§Ø³Ù… ÙˆØ§Ù„ÙˆØ±Ø¯ÙŠØ©
    employees = employees.filter(emp => !(emp.name === name && emp.shift === shift));

    if (employees.length < initialLength) {
        saveEmployees();
        // closeAdminModal(); 
        renderSchedule();
        showNotification(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù "${name}" Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ù† ÙˆØ±Ø¯ÙŠØ© ${shift}.`, 'success');
    } else {
        showNotification(`Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ø¬Ø² Ù„Ù„Ù…ÙˆØ¸Ù "${name}" ÙÙŠ ÙˆØ±Ø¯ÙŠØ© ${shift}.`, 'error');
    }
}
      
      // Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ø®Ø§Øµ Ø¨Ø²Ø± Ù…Ø³Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
deleteStorageButton.addEventListener('click', clearEmployeeStorage);

// Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ø®Ø§Øµ Ø¨Ø²Ø± Ø­Ø°Ù Ø¨Ø±ÙŠÙƒ Ù…ÙˆØ¸Ù Ù…Ø­Ø¯Ø¯
deleteSingleBreakButton.addEventListener('click', deleteSingleBreak);

// Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ø®Ø§Øµ Ø¨Ø²Ø± Ø­Ø°Ù Ù…ÙˆØ¸Ù ÙƒØ§Ù…Ù„ (Ø¬Ù…ÙŠØ¹ Ø¨Ø±ÙŠÙƒØ§ØªÙ‡)
deleteEmployeeButton.addEventListener('click', deleteEmployeeAndBreaks);

      function deleteSingleBreak() {
    // ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù‡Ø°Ù‡ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ù…ÙØ¹Ø±ÙØ© ÙƒØ¹Ù†Ø§ØµØ± DOM ÙÙŠ ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    const name = adminEmployeeSelect.value;
    const shift = adminShiftSelect.value;
    const breakIndex = parseInt(adminBreakIndexSelect.value, 10);

    if (!name || !shift || isNaN(breakIndex)) {
        showNotification('ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆØ¸ÙØŒ ÙˆØ±Ø¯ÙŠØ©ØŒ ÙˆØ±Ù‚Ù… Ø¨Ø±ÙŠÙƒ Ù„Ù„Ø­Ø°Ù.', 'error');
        return;
    }

    const employee = employees.find(emp => emp.name === name && emp.shift === shift);

    if (employee) {
        if (employee.breaks[breakIndex]) {
            const deletedBreakTime = employee.breaks[breakIndex].time;
            employee.breaks.splice(breakIndex, 1); // Ø­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ±
            
            saveEmployees();
            // closeAdminModal();
            renderSchedule();
            showNotification(`ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø±Ù‚Ù… ${breakIndex + 1} (${deletedBreakTime}) Ù„Ù„Ù…ÙˆØ¸Ù ${name} Ø¨Ù†Ø¬Ø§Ø­.`, 'success');
        } else {
            showNotification('Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠÙƒ ØºÙŠØ± Ù…Ø­Ø¬ÙˆØ² Ø£Ø³Ø§Ø³Ø§Ù‹ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸Ù.', 'warning');
        }
    } else {
        showNotification('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø­Ø¯Ø¯.', 'error');
    }
}
        function getLocalStorageSize() {
            let totalBytes = 0;
            // ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø®Ø§Øµ Ø¨Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙÙ‚Ø·
            const data = localStorage.getItem('breakTimeBuddyEmployees');
            if (data) {
                // Ø§Ù„Ø­Ø¬Ù… Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ = Ø·ÙˆÙ„ Ø§Ù„Ù…ÙØªØ§Ø­ + Ø·ÙˆÙ„ Ø§Ù„Ù‚ÙŠÙ…Ø© (Ø¨ÙˆØ­Ø¯Ø© Ø§Ù„Ø¨Ø§ÙŠØª)
                totalBytes += 'breakTimeBuddyEmployees'.length * 2 + data.length * 2;
            }
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ø§ÙŠØª Ø¥Ù„Ù‰ ÙƒÙŠÙ„ÙˆØ¨Ø§ÙŠØª ÙˆØªÙ‚Ø±ÙŠØ¨Ù‡
            return (totalBytes / 1024).toFixed(2);
        }

        function openAdminModal() {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù†Ø¯ ÙØªØ­Ù‡Ø§
            adminCode.value = '';
            adminStep1.classList.remove('hidden');
            adminStep2.classList.add('hidden');
            
            adminModal.classList.remove('hidden', 'opacity-0');
            // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„
            setTimeout(() => adminModal.classList.remove('opacity-0'), 10);
            adminCode.focus();
        }

        function checkAdminLogin() {
            if (adminCode.value === ADMIN_CODE) {
                storageSizeDisplay.textContent = `${getLocalStorageSize()} KB`; // Ø¹Ø±Ø¶ Ø­Ø¬Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ†
                adminStep1.classList.add('hidden');
                adminStep2.classList.remove('hidden');
                showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ….', 'info');
            } else {
                showNotification('Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­.', 'error');
                adminCode.value = ''; // Ù…Ø³Ø­ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
            }
        }

        function clearEmployeeStorage() {
            // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³Ø­
            if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!")) {
                return;
            }

            // âš ï¸ ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø®Ø§Øµ Ø¨Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
            localStorage.removeItem('breakTimeBuddyEmployees'); 
            
            employees = []; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ
            
            // Ø¥Ø®ÙØ§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø³Ø­
            adminModal.classList.add('hidden', 'opacity-0'); 
            showNotification('ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­! ğŸ—‘ï¸', 'success');

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù
            if (selectedShift) {
                renderTimeSlots();
                renderSchedule();
            }
        }

        // ---------------------------------------------------------------------
        // ÙˆØ¸Ø§Ø¦Ù Ø±Ø¦ÙŠØ³ÙŠØ©
        // ---------------------------------------------------------------------
 
              // ****** Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: Ø­Ø°Ù Ù…ÙˆØ¸Ù ÙƒØ§Ù…Ù„ ******
        function deleteEmployeeAndBreaks() {
            const nameToDelete = deleteEmployeeName.value.trim();

            if (!nameToDelete) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø±Ø§Ø¯ Ø­Ø°ÙÙ‡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.', 'error');
                return;
            }

            const initialLength = employees.length;
            
            // ØªØµÙÙŠØ© Ø§Ù„Ù…ØµÙÙˆÙØ© Ù„Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸Ù (Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù„Ù‡ Ø³Ø¬Ù„ ÙÙŠ Ø§Ù„ÙˆØ±Ø¯ÙŠØ© Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ© ÙˆØ§Ù„Ù…Ø³Ø§Ø¦ÙŠØ©)
            employees = employees.filter(emp => emp.name !== nameToDelete);
            
            const newLength = employees.length;
            const employeesRemoved = initialLength - newLength;


            if (employeesRemoved === 0) {
                showNotification(`Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø³Ø¬Ù„Ø§Øª Ù„Ù„Ù…ÙˆØ¸Ù: ${nameToDelete}`, 'warning');
                return;
            }
            
            // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
            if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª (${employeesRemoved} Ø³Ø¬Ù„) ÙˆØ­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø¨Ø±ÙŠÙƒ Ù„Ù„Ù…ÙˆØ¸Ù ${nameToDelete}ØŸ`)) {
                employees = JSON.parse(localStorage.getItem('breakTimeBuddyEmployees')) || []; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø¥Ø°Ø§ Ø£Ù„ØºÙ‰
                return;
            }

            saveEmployees(); // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚Ù„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            deleteEmployeeName.value = '';
            showNotification(`ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù ${nameToDelete} (${employeesRemoved} Ø³Ø¬Ù„) Ø¨Ù†Ø¬Ø§Ø­. Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø£ØµØ¨Ø­Øª Ù…ØªØ§Ø­Ø© Ø§Ù„Ø¢Ù†.`, 'success');

            // Ø¥Ø®ÙØ§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            adminModal.classList.add('hidden', 'opacity-0');

            if (selectedShift) {
                renderTimeSlots(); // ØªØ­Ø¯ÙŠØ« Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù…ØªØ§Ø­Ø©
                renderSchedule(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
            }
        }


        // ****** Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©: Ø­Ø°Ù Ø¨Ø±ÙŠÙƒ Ù…ÙˆØ¸Ù Ù…Ø­Ø¯Ø¯ ******
        function deleteSingleBreak() {
            const name = deleteBreakName.value.trim();
            const indexStr = deleteBreakIndex.value.trim();
            const index = parseInt(indexStr);

            if (!name || isNaN(index) || index < 1 || index > 3) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ù…ÙˆØ¸Ù ØµØ­ÙŠØ­ ÙˆØ±Ù‚Ù… Ø¨Ø±ÙŠÙƒ Ø¨ÙŠÙ† 1 Ùˆ 3.', 'error');
                return;
            }

            const employeeIndex = employees.findIndex(emp => emp.name === name);

            if (employeeIndex === -1) {
                showNotification(`Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…ÙˆØ¸Ù Ø¨Ø§Ø³Ù…: ${name}`, 'error');
                return;
            }

            const emp = employees[employeeIndex];
            const breakToRemoveIndex = index - 1; // ØªØ­ÙˆÙŠÙ„ Ù…Ù† (1, 2, 3) Ø¥Ù„Ù‰ (0, 1, 2)

            if (!emp.breaks || breakToRemoveIndex >= emp.breaks.length || !emp.breaks[breakToRemoveIndex].time) {
                showNotification(`Ø§Ù„Ù…ÙˆØ¸Ù ${name} Ù„Ù… ÙŠØ­Ø¬Ø² Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø±Ù‚Ù… ${index} Ø£Ùˆ Ø£Ù†Ù‡ Ù…Ø­Ø°ÙˆÙ Ù…Ø³Ø¨Ù‚Ù‹Ø§.`, 'warning');
                return;
            }

            // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
            const breakInfo = emp.breaks[breakToRemoveIndex];
            if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø±Ù‚Ù… ${index} (${breakInfo.duration} Ø¯Ù‚ÙŠÙ‚Ø© ÙŠØ¨Ø¯Ø£ Ø¹Ù†Ø¯ ${breakInfo.time}) Ù„Ù„Ù…ÙˆØ¸Ù ${name}ØŸ Ù‡Ø°Ø§ Ø³ÙŠØ¬Ø¹Ù„Ù‡ Ù…ØªØ§Ø­Ù‹Ø§ Ù„Ù„Ø­Ø¬Ø² Ù…Ø¬Ø¯Ø¯Ø§Ù‹.`)) {
                return;
            }

            // Ø­Ø°Ù Ø§Ù„Ø¨Ø±ÙŠÙƒ: Ù†Ø³ØªØ®Ø¯Ù… splice Ù„Ø­Ø°ÙÙ‡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ù† Ø§Ù„Ù…ØµÙÙˆÙØ©
            emp.breaks.splice(breakToRemoveIndex, 1);
            
            saveEmployees(); // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù

            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            deleteBreakName.value = '';
            deleteBreakIndex.value = '';
            showNotification(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø±Ù‚Ù… ${index} Ù„Ù„Ù…ÙˆØ¸Ù ${name} Ø¨Ù†Ø¬Ø§Ø­. Ø§Ù„ÙˆÙ‚Øª Ù…ØªØ§Ø­ Ø§Ù„Ø¢Ù† Ù„Ù„Ø­Ø¬Ø².`, 'success');

            // Ø¥Ø®ÙØ§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            adminModal.classList.add('hidden', 'opacity-0');

            if (selectedShift) {
                renderTimeSlots(); // ØªØ­Ø¯ÙŠØ« Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù…ØªØ§Ø­Ø©
                renderSchedule(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø£Ù† Ø§Ù„Ø¨Ø±ÙŠÙƒ Ù‚Ø¯ Ø­Ø°Ù
            }
        }

        function selectShift(shift) {
            selectedShift = shift;
            
            document.querySelectorAll('.shift-card').forEach(card => {
                card.classList.remove('border-indigo-600', 'ring-4', 'ring-indigo-200', 'dark:ring-indigo-900');
                card.classList.add('border-transparent');
            });

            const selectedElement = document.getElementById(`${shift}Shift`);
            selectedElement.classList.remove('border-transparent');
            selectedElement.classList.add('border-indigo-600', 'ring-4', 'ring-indigo-200', 'dark:ring-indigo-900');

            setTimeout(() => {
                shiftSelection.classList.add('hidden');
                breakSelection.classList.remove('hidden');
                renderTimeSlots();
                renderSchedule(); 
                updateAllTimers();
            }, 200); 
        }
        
        function renderTimeSlots() {
            const now = new Date();
            
            const lastPossibleBreakTime = selectedShift === 'morning' ? '04:00 Ù…' : '10:00 Ù…';
            const lastBreakEnd = timeToDate(lastPossibleBreakTime);
            const isShiftClosed = lastBreakEnd.getTime() < now.getTime();

            timeSlotsContainer.innerHTML = '';
            const slots = selectedShift === 'morning' ? morningBreakStartTimes : eveningBreakStartTimes;
            
            if (isShiftClosed) {
                timeSlotsContainer.innerHTML = `<p class="col-span-full text-center text-red-600 font-semibold py-4 bg-red-50 rounded-lg dark:bg-red-900 dark:text-red-300">
                    Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø­Ø¬Ø² Ø§Ù„Ø¨Ø±ÙŠÙƒØ§Øª Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ±Ø¯ÙŠØ© Ù„Ù„ÙŠÙˆÙ….
                </p>`;
                confirmButton.disabled = true;
                return;
            }
            
            // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø­Ø§Ù„ÙŠØ§Ù‹
            const currentIndex = selectedBreaks.length;
            const requiredDuration = currentIndex < MAX_TOTAL_BREAKS ? REQUIRED_ORDER[currentIndex] : null;

            // Ø¯Ù…Ø¬ ÙƒÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„ÙˆØ±Ø¯ÙŠØ© (Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚)
            const allBookedSlots = employees
                                            .filter(emp => emp.shift === selectedShift)
                                            .flatMap(emp => emp.breaks)
                                            .map(b => `${b.time}-${b.duration}`);


            slots.forEach(slot => {
                const slotStartTime = slot.time;
                const duration = slot.duration;
                const slotEndTime = getBreakEndString(slotStartTime, duration);
                const uniqueSlotKey = `${slotStartTime}-${duration}`;

                // Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¬Ø²: Ù…Ø­Ø¬ÙˆØ²Ø© Ù…Ù† Ù…ÙˆØ¸Ù Ø¢Ø®Ø±
                const isBooked = allBookedSlots.includes(uniqueSlotKey);
                
                // Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±: Ù…Ø®ØªØ§Ø±Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§ Ù…Ù† Ù‚Ø¨Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const isSelected = selectedBreaks.some(b => b.time === slotStartTime && b.duration === duration);
                
                // Ø­Ø§Ù„Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª
                const breakTimeEnd = new Date(timeToDate(slotStartTime).getTime() + duration * 60000);
                const isPastTime = breakTimeEnd.getTime() < now.getTime();
                
                // ******* Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„ØªØ·Ø¨ÙŠÙ‚ Ù‚ÙŠØ¯ Ø§Ù„ØªØ±ØªÙŠØ¨ *******
                const isIncorrectDuration = requiredDuration !== null && duration !== requiredDuration;

                // Ø­Ø§Ù„Ø© ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ (3 Ø¨Ø±ÙŠÙƒØ§Øª)
                const isTotalMaxed = selectedBreaks.length >= MAX_TOTAL_BREAKS && !isSelected;
                
                const isDisabled = isBooked || isPastTime || isIncorrectDuration || isTotalMaxed;

                let slotClasses;
                let statusText;
                let durationText = `(${duration} Ø¯Ù‚ÙŠÙ‚Ø©)`;

                if (isPastTime) {
                    slotClasses = 'bg-gray-200 text-gray-500 cursor-not-allowed booked dark:bg-gray-700 dark:text-gray-400';
                    statusText = 'Ø§Ù†ØªÙ‡Øª';
                } else if (isBooked) {
                    slotClasses = 'bg-gray-300 text-red-600 cursor-not-allowed booked dark:bg-gray-700 dark:text-red-400';
                    statusText = 'Ù…Ø­Ø¬ÙˆØ²Ø©';
                } else if (isSelected) {
                    slotClasses = 'bg-indigo-600 text-white shadow-lg border-2 border-indigo-800 dark:bg-indigo-700 dark:border-indigo-500 dark:shadow-indigo-500/50';
                    statusText = 'Ù…Ø®ØªØ§Ø±Ø©';
                } else if (isIncorrectDuration) {
                    slotClasses = 'bg-gray-200 text-orange-600 cursor-not-allowed booked dark:bg-gray-700 dark:text-orange-400';
                    statusText = `ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø±ÙŠÙƒ ${requiredDuration} Ø¯Ù‚ÙŠÙ‚Ø©`;
                } else if (isTotalMaxed) {
                    slotClasses = 'bg-gray-200 text-red-600 cursor-not-allowed booked dark:bg-gray-700 dark:text-red-400';
                    statusText = 'Ø§ÙƒØªÙ…Ù„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¨Ø±ÙŠÙƒØ§Øª';
                } else {
                    slotClasses = 'bg-white text-indigo-600 hover:bg-indigo-100 border border-indigo-200 dark:bg-gray-800 dark:text-indigo-400 dark:hover:bg-gray-700 dark:border-indigo-900';
                    statusText = 'Ù…ØªØ§Ø­Ø© Ù„Ù„Ø­Ø¬Ø²';
                }
                
                const slotElement = document.createElement('button');
                slotElement.className = `time-slot p-3 rounded-lg text-center text-sm font-bold ${slotClasses}`;
                slotElement.innerHTML = `
                    <span class="block text-xs font-normal mb-1">${durationText}</span>
                    <span class="block">${slotStartTime} - ${slotEndTime}</span>
                    <span class="block text-xs font-normal mt-1">${statusText}</span>
                `;
                slotElement.disabled = isDisabled;
                
                if (!isDisabled || isSelected) {
                    slotElement.addEventListener('click', () => toggleBreakSelection(slotStartTime, duration));
                }
                
                timeSlotsContainer.appendChild(slotElement);
            });
        }

        // ******* Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ 3: Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø²Ù…Ù†ÙŠ *******
        function toggleBreakSelection(slotStartTime, duration) {
            const index = selectedBreaks.findIndex(b => b.time === slotStartTime && b.duration === duration);
            
            if (index !== -1) {
                // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ùˆ Ø¢Ø®Ø± Ø¨Ø±ÙŠÙƒ ØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡
                if (index !== selectedBreaks.length - 1) {
                    showNotification('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ù„ØºØ§Ø¡ Ø¨Ø±ÙŠÙƒ Ù…Ù† Ø§Ù„Ù…Ù†ØªØµÙØŒ ÙŠØ¬Ø¨ Ø¥Ù„ØºØ§Ø¡ Ø¢Ø®Ø± Ø¨Ø±ÙŠÙƒ ØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡ Ø£ÙˆÙ„Ø§Ù‹.', 'error');
                    return;
                }
                
                selectedBreaks.splice(index, 1);
            } else {
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
                
                const currentSelectionIndex = selectedBreaks.length;
                
                if (currentSelectionIndex >= MAX_TOTAL_BREAKS) {
                    showNotification('ØªÙ… Ø§Ø®ØªÙŠØ§Ø± 3 Ø¨Ø±ÙŠÙƒØ§Øª Ø¨Ø§Ù„ÙØ¹Ù„.', 'error');
                    return;
                }

                const requiredDuration = REQUIRED_ORDER[currentSelectionIndex];
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ (Ø§Ù„Ù…Ø¯Ø©)
                if (duration !== requiredDuration) {
                    showNotification(`Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø±Ù‚Ù… ${currentSelectionIndex + 1} ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ${requiredDuration} Ø¯Ù‚ÙŠÙ‚Ø©.`, 'error');
                    return;
                }
                
                // Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø²Ù…Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø§Ù„ØªØ³Ù„Ø³Ù„ ÙˆØ¹Ø¯Ù… Ø§Ù„ØªØ¯Ø§Ø®Ù„)
                if (selectedBreaks.length > 0) {
                    const lastBreak = selectedBreaks[selectedBreaks.length - 1];
                    const lastBreakStartTime = timeToDate(lastBreak.time);
                    const lastBreakEndTime = new Date(lastBreakStartTime.getTime() + lastBreak.duration * 60000); // ÙˆÙ‚Øª Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø§Ù„Ø£Ø®ÙŠØ±
                    const newBreakStartTime = timeToDate(slotStartTime); // ÙˆÙ‚Øª Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯

                    // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙˆÙ‚Øª Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø£ØµØºØ± Ù…Ù† Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ ÙˆÙ‚Øª Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø§Ù„Ø£Ø®ÙŠØ±ØŒ ÙØ¥Ù†Ù‡ Ù…ØªØ¯Ø§Ø®Ù„ Ø£Ùˆ Ù…Ø¹ÙƒÙˆØ³.
                    if (newBreakStartTime <= lastBreakEndTime) {
                        const lastBreakEndTimeString = getBreakEndString(lastBreak.time, lastBreak.duration);
                        showNotification(`Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø±Ù‚Ù… ${currentSelectionIndex + 1} ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚ (Ø¨Ø¹Ø¯ ${lastBreakEndTimeString}).`, 'error');
                        return;
                    }
                }
                
                selectedBreaks.push({ time: slotStartTime, duration: duration });
                
                // Ø§Ù„ÙØ±Ø² Ù„ÙŠØ³ Ø¶Ø±ÙˆØ±ÙŠØ§Ù‹ Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¢Ù† Ø¨Ù„ Ù†Ø¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
            }
            
            renderTimeSlots();
            selectedCount.textContent = selectedBreaks.length;
            
            const isThreeBreaks = selectedBreaks.length === MAX_TOTAL_BREAKS;
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù„Ù…Ø¯Ø¯
            const isCorrectDurationOrder = isThreeBreaks && selectedBreaks.every((b, i) => b.duration === REQUIRED_ORDER[i]);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø²Ù…Ù†ÙŠ (Ù…ØªØªØ§Ù„ÙŠ ÙˆØºÙŠØ± Ù…ØªØ¯Ø§Ø®Ù„)
            let isCorrectTimeOrder = true;
            for(let i = 1; i < selectedBreaks.length; i++) {
                const prevBreak = selectedBreaks[i-1];
                const currentBreak = selectedBreaks[i];

                const prevBreakStartTime = timeToDate(prevBreak.time);
                const prevBreakEndTime = new Date(prevBreakStartTime.getTime() + prevBreak.duration * 60000);
                const currentBreakStartTime = timeToDate(currentBreak.time);

                if (currentBreakStartTime <= prevBreakEndTime) {
                    isCorrectTimeOrder = false;
                    break;
                }
            }

            confirmButton.disabled = !(isCorrectDurationOrder && isCorrectTimeOrder && employeeName.value.trim());
        }

        // ******* Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ 4: Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸ Ø¯Ø§Ø®Ù„ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø² *******
        function confirmReservation() {
            const name = employeeName.value.trim();
            
            const isThreeBreaks = selectedBreaks.length === MAX_TOTAL_BREAKS;
            const isCorrectDurationOrder = isThreeBreaks && selectedBreaks.every((b, i) => b.duration === REQUIRED_ORDER[i]);
            
            let isCorrectTimeOrder = true;
            for(let i = 1; i < selectedBreaks.length; i++) {
                const prevBreak = selectedBreaks[i-1];
                const currentBreak = selectedBreaks[i];
                const prevBreakStartTime = timeToDate(prevBreak.time);
                const prevBreakEndTime = new Date(prevBreakStartTime.getTime() + prevBreak.duration * 60000);
                const currentBreakStartTime = timeToDate(currentBreak.time);
                if (currentBreakStartTime <= prevBreakEndTime) {
                    isCorrectTimeOrder = false;
                    break;
                }
            }
            
            if (!name || !isCorrectDurationOrder || !isCorrectTimeOrder) {
                showNotification('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ø®ØªÙŠØ§Ø± 3 Ø¨Ø±ÙŠÙƒØ§Øª Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ (15ØŒ 30ØŒ 15) ÙˆØ¨ØªØ³Ù„Ø³Ù„ Ø²Ù…Ù†ÙŠ ØµØ­ÙŠØ­ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø².', 'error');
                return;
            }
            
            if (employees.some(emp => emp.name === name && emp.shift === selectedShift)) {
                showNotification(`Ø§Ù„Ù…ÙˆØ¸Ù ${name} Ù„Ø¯ÙŠÙ‡ Ø­Ø¬Ø² Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ±Ø¯ÙŠØ©.`, 'error');
                return;
            }
            
            const employee = {
                name,
                shift: selectedShift,
                breaks: [...selectedBreaks], // Ù†Ø³Ø® Ø§Ù„Ø¨Ø±ÙŠÙƒØ§Øª Ø¨Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„Ù…Ø¯Ø©
                confirmedAt: new Date().toISOString()
            };
            
            employees.push(employee);
            saveEmployees(); // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            renderSchedule();
            
            employeeName.value = '';
            selectedBreaks = [];
            selectedCount.textContent = '0';
            confirmButton.disabled = true;
            renderTimeSlots();
            
            showNotification(`ØªÙ… Ø­Ø¬Ø² Ø§Ù„Ø¨Ø±ÙŠÙƒØ§Øª Ù„Ù€ ${name} Ø¨Ù†Ø¬Ø§Ø­ âœ…`, 'success');
        }
        
        function createBreakCellContent(breakItem) {
            const breakTime = breakItem.time;
            const duration = breakItem.duration;
            const breakEndString = getBreakEndString(breakTime, duration);
            
            const durationTextClass = duration === 30 ? 'text-red-600 dark:text-red-400' : 'text-green-600 dark:text-green-400';

            return `
                <span class="inline-block font-bold text-sm text-gray-800 dark:text-gray-100">${breakTime} - ${breakEndString}</span>
                <span class="block text-xs font-medium ${durationTextClass}">(${duration} Ø¯Ù‚ÙŠÙ‚Ø©)</span>
                <div id="status-timer-${breakTime.replace(/ /g, '-').replace(/:/g, '-')}-${duration}" class="timer-display mt-1">
                    </div>
            `;
        }

      // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø­Ø°Ù Ø­Ø¬Ø² Ù…ÙˆØ¸Ù ÙˆØ§Ø­Ø¯
Â  Â  Â  Â  function deleteEmployeeBreak(name, shift) {
Â  Â  Â  Â  Â  Â  if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø­Ø¬Ø² Ø§Ù„Ø¨Ø±ÙŠÙƒØ§Øª Ù„Ù„Ù…ÙˆØ¸Ù: ${name} ÙÙŠ ÙˆØ±Ø¯ÙŠØ© ${shift === 'morning' ? 'Ø§Ù„ØµØ¨Ø§Ø­' : 'Ø§Ù„Ù…Ø³Ø§Ø¡'}ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.`)) {
Â  Â  Â  Â  Â  Â  Â  Â  return; // Ø¥Ù„ØºØ§Ø¡ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙˆØ¸Ù ÙˆØ­Ø°ÙÙ‡
Â  Â  Â  Â  Â  Â  const initialLength = employees.length;
Â  Â  Â  Â  Â  Â  employees = employees.filter(emp => !(emp.name === name && emp.shift === shift));

Â  Â  Â  Â  Â  Â  if (employees.length < initialLength) {
Â  Â  Â  Â  Â  Â  Â  Â  saveEmployees(); // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù
Â  Â  Â  Â  Â  Â  Â  Â  renderSchedule(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø£Ù† Ø§Ù„Ø­Ø¬Ø² Ù‚Ø¯ Ø­Ø°Ù
Â  Â  Â  Â  Â  Â  Â  Â  renderTimeSlots(); // ØªØ­Ø¯ÙŠØ« Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù…ØªØ§Ø­Ø© (Ù„Ø£Ù† Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø£ØµØ¨Ø­Øª Ù…ØªØ§Ø­Ø© Ø§Ù„Ø¢Ù†)
Â  Â  Â  Â  Â  Â  Â  Â  updateAllTimers();
Â  Â  Â  Â  Â  Â  Â  Â  showNotification(`ØªÙ… Ø­Ø°Ù Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ¸Ù ${name} Ø¨Ù†Ø¬Ø§Ø­.`, 'warning');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  showNotification('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¬Ø² Ù„Ù„Ø­Ø°Ù.', 'error');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
      
        function renderSchedule() {
            const filteredEmployees = employees.filter(emp => emp.shift === selectedShift);

            if (filteredEmployees.length === 0) {
                scheduleContent.innerHTML = `
                    <div class="grid grid-cols-12 text-center items-center py-4 px-2 text-gray-500 dark:text-gray-400">
                        <div class="col-span-12 p-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ±Ø¯ÙŠØ© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</div>
                    </div>
                `;
                return;
            }
            
            // ÙØ±Ø² Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
            filteredEmployees.sort((a, b) => {
                const timeA = timeToDate(a.breaks[0].time);
                const timeB = timeToDate(b.breaks[0].time);
                return timeA - timeB;
            });
            
            scheduleContent.innerHTML = filteredEmployees.map((emp, index) => {
                const rowClass = index % 2 === 0 ? 'bg-white dark:bg-gray-800' : 'bg-gray-50 dark:bg-gray-900';
                
                const breakCells = emp.breaks.map(breakItem => `
                    <div class="col-span-3 p-3 border-r border-gray-200 dark:border-gray-700">
                        ${createBreakCellContent(breakItem)}
                    </div>
                `).join('');
                
                return `
                    <div class="grid grid-cols-12 text-center items-center py-3 px-2 ${rowClass} hover:bg-indigo-50 dark:hover:bg-indigo-900/40 transition-colors">
                        <div class="col-span-3 p-3 font-extrabold text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-700">${emp.name}</div>
                        ${breakCells}
                    </div>
                `;
            }).join('');
        }

        let timerInterval = null;

        function updateTimer(breakItem) {
            const now = new Date();
            const breakStartTime = timeToDate(breakItem.time);
            const breakEndTime = new Date(breakStartTime.getTime() + breakItem.duration * 60000);
            
            const timerId = `status-timer-${breakItem.time.replace(/ /g, '-').replace(/:/g, '-')}-${breakItem.duration}`;
            const timerElement = document.getElementById(timerId);

            if (!timerElement) return; // Ù‚Ø¯ Ù„Ø§ ÙŠÙƒÙˆÙ† Ø§Ù„Ø¹Ù†ØµØ± Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ Ø¥Ø°Ø§ ØªÙ… ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ±Ø¯ÙŠØ©

            let statusHTML = '';

            if (now < breakStartTime) {
                // Ø­Ø§Ù„Ø©: Ù„Ù… ÙŠØ¨Ø¯Ø£ Ø¨Ø¹Ø¯ (ÙŠØªØ¨Ù‚Ù‰)
                const msUntilStart = breakStartTime.getTime() - now.getTime();
                statusHTML = `
                    <span class="timer-text text-blue-600 dark:text-blue-400">
                        ÙŠØ¨Ø¯Ø£ Ø¨Ø¹Ø¯: ${formatTimeDifference(msUntilStart)}
                    </span>
                `;
            } else if (now >= breakStartTime && now < breakEndTime) {
                // Ø­Ø§Ù„Ø©: Ø§Ù„Ø¨Ø±ÙŠÙƒ Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„ (Ù…ØªØ¨Ù‚ÙŠ)
                const msRemaining = breakEndTime.getTime() - now.getTime();
                statusHTML = `
                    <span class="timer-text text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/50 px-2 py-0.5 rounded-full">
                        Ù…ØªØ¨Ù‚ÙŠ: ${formatTimeDifference(msRemaining)}
                    </span>
                `;
            } else {
                // Ø­Ø§Ù„Ø©: Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø¨Ø±ÙŠÙƒ
                statusHTML = `
                    <span class="timer-text text-gray-500 dark:text-gray-500">
                        Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø¨Ø±ÙŠÙƒ
                    </span>
                `;
            }

            timerElement.innerHTML = statusHTML;
        }

        function updateAllTimers() {
            if (!selectedShift) return;

            // ØªØ­Ø¯ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø±ÙŠÙƒØ§Øª ÙÙŠ Ø§Ù„ÙˆØ±Ø¯ÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹
            const activeBreaks = employees
                                    .filter(emp => emp.shift === selectedShift)
                                    .flatMap(emp => emp.breaks);
            
            // ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ù‚Øª ÙƒÙ„ Ø¨Ø±ÙŠÙƒ
            activeBreaks.forEach(breakItem => updateTimer(breakItem));

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            const now = new Date();
            const options = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };
            currentTimeDisplay.textContent = `Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${now.toLocaleTimeString('ar-EG', options)}`;
        }

        function startTimerLoop() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
            timerInterval = setInterval(updateAllTimers, 1000);
        }
        
        function resetSelection() {
            selectedShift = null;
            selectedBreaks = [];
            employeeName.value = '';
            selectedCount.textContent = '0';
            confirmButton.disabled = true;
            
            shiftSelection.classList.remove('hidden');
            breakSelection.classList.add('hidden');
        }

        // INITIALIZATION AND EVENT LISTENERS

        // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        confirmButton.addEventListener('click', confirmReservation);
        employeeName.addEventListener('input', () => {
            const isThreeBreaks = selectedBreaks.length === MAX_TOTAL_BREAKS;
            const isCorrectDurationOrder = isThreeBreaks && selectedBreaks.every((b, i) => b.duration === REQUIRED_ORDER[i]);
            confirmButton.disabled = !(isCorrectDurationOrder && employeeName.value.trim());
        });
        themeToggle.addEventListener('click', toggleTheme);
        
        // ****** Ø±Ø¨Ø· Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ******
        adminToggle.addEventListener('click', openAdminModal);
        adminLoginButton.addEventListener('click', checkAdminLogin);
        deleteStorageButton.addEventListener('click', clearEmployeeStorage);
        adminCode.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') {
                checkAdminLogin();
            }
        });
        // ***************************************

        // Ø¨Ø¯Ø¡ Ø­Ù„Ù‚Ø© Ø§Ù„Ù…Ø¤Ù‚Øª
        startTimerLoop();
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
        updateThemeIcon();
        updateAllTimers(); // ØªØ­Ø¯ÙŠØ« Ø£ÙˆÙ„ÙŠ Ù„Ù„Ø³Ø§Ø¹Ø© ÙˆØ§Ù„Ù…Ø¤Ù‚ØªØ§Øª
    </script>
</body>
</html>
